<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LISTA DE PARTICIPANTES</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4 flex justify-between">
    <h1 class="text-3xl font-bold mb-4">Lista de Participantes</h1>  
    <button id="print-pdf-button" class="w-100% h-10 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-5 rounded-lg shadow">
      Imprimir Asistencia en PDF
    </button>     
  </div>
  <div>
    <table id="myTable" class="min-w-full divide-y divide-gray-200 shadow overflow-hidden sm:rounded-lg mt-4">
      <thead class="bg-gray-800 text-white">
        <tr>
          <th class="px-6 py-3 text-left">Fecha</th>
          <th class="px-6 py-3 text-left">Nombre</th>
          <th class="px-6 py-3 text-left">Cedula</th>
          <th class="px-6 py-3 text-left">Telefono</th>
          <th class="px-6 py-3 text-left">Hora Entrada</th>
          <th class="px-6 py-3 text-left">Hora Salida</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <!-- Aquí se agregarán las filas dinámicamente -->
      </tbody>
    </table>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
  <script>
$(document).ready(function() {
  // Llamar a la función para obtener y agregar datos a la tabla al cargar la página
  obtenerDatosAsistencia();
});

// Función para obtener datos de asistencia desde la API y agregarlos a la tabla
function obtenerDatosAsistencia() {
  fetch('http://localhost/lectorqr/controllers/get.php')
    .then(response => response.json())
    .then(data => {
      console.log("Datos recibidos:", data);
      agregarDatosATabla(data); // Llamar a la función para agregar datos a la tabla
      // Inicializar DataTables después de agregar los datos
      $('#myTable').DataTable({
        "paging": true,
        "info": true,
        "searching": true,
        "lengthMenu": [5, 10, 25, 50, 100],
        "responsive": true
      });
    })
    .catch(error => {
      console.error('Error al obtener datos de asistencia:', error);
      // Manejar el error según sea necesario
    });
}

// Función para agregar datos a la tabla
function agregarDatosATabla(data) {
  const tbody = $('#myTable tbody');
  tbody.empty();

  data.forEach(item => {
    const row = $('<tr>').appendTo(tbody);
    $('<td>').text(item.fecha).appendTo(row);
    $('<td>').text(item.nombre).appendTo(row);
    $('<td>').text(item.cedula).appendTo(row);
    $('<td>').text(item.telefono).appendTo(row);
    $('<td>').text(item.hora_entrada).appendTo(row);
    $('<td>').text(item.hora_salida).appendTo(row);
  });
}

document.getElementById('print-pdf-button').addEventListener('click', function () {
      var element = document.body; // You can select specific content here if needed
      var opt = {
          margin: 0,
          filename: 'attendance.pdf',
          image: { // Optional: Adjust image scaling if needed
              type: 'jpeg',
              quality: 0.9
          }
      };
      html2pdf().from(element).set(opt).save();
  });
  </script>


</body>
</html>
